<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>平均数教学 - 移多补少法</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Arial Rounded MT Bold', 'Microsoft YaHei', sans-serif;
      }

      body {
        background: linear-gradient(135deg, #e0f7fa, #bbdefb);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        width: 100%;
        max-width: 1000px;
        background-color: white;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        overflow: hidden;
      }

      header {
        background: linear-gradient(90deg, #2196f3, #21cbf3);
        color: white;
        padding: 20px;
        text-align: center;
      }

      h1 {
        font-size: 2.2rem;
        margin-bottom: 10px;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      .subtitle {
        font-size: 1.2rem;
        opacity: 0.9;
      }

      .content {
        display: flex;
        padding: 20px;
        gap: 20px;
      }

      .instructions {
        flex: 1;
        background-color: #f9f9f9;
        border-radius: 15px;
        padding: 20px;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
      }

      .instructions h2 {
        color: #2196f3;
        margin-bottom: 15px;
        font-size: 1.6rem;
      }

      .instructions ol {
        padding-left: 25px;
        margin-bottom: 20px;
      }

      .instructions li {
        margin-bottom: 10px;
        line-height: 1.5;
        font-size: 1.1rem;
      }

      .formula-box {
        background: #e3f2fd;
        border-left: 4px solid #2196f3;
        padding: 15px;
        border-radius: 0 8px 8px 0;
        margin: 20px 0;
        font-size: 1.3rem;
        text-align: center;
        font-weight: bold;
      }

      .animation-area {
        flex: 2;
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .groups-container {
        background-color: #f5f5f5;
        border-radius: 15px;
        padding: 20px;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-around;
        gap: 20px;
        min-height: 300px;
        box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.1);
      }

      .group {
        background-color: white;
        border-radius: 12px;
        padding: 15px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        width: 180px;
        text-align: center;
      }

      .group-title {
        font-weight: bold;
        margin-bottom: 15px;
        color: #2196f3;
        font-size: 1.2rem;
      }

      .bottles-container {
        min-height: 180px;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: center;
        align-items: flex-end;
        padding: 10px;
        background: #e1f5fe;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .bottle {
        width: 40px;
        height: 60px;
        background-color: #4fc3f7;
        border-radius: 6px;
        position: relative;
        cursor: grab;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: bold;
        color: rgba(0, 0, 0, 0.7);
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .bottle:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 10px rgba(0, 0, 0, 0.15);
      }

      .bottle.dragging {
        opacity: 0.8;
        transform: scale(1.05);
        cursor: grabbing;
      }

      .stats-container {
        background-color: #e3f2fd;
        border-radius: 15px;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .stats-row {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        background: white;
        border-radius: 8px;
        font-size: 1.1rem;
      }

      .stats-value {
        font-weight: bold;
        color: #2196f3;
      }

      .average-display {
        text-align: center;
        font-size: 1.3rem;
        padding: 15px;
        background: #bbdefb;
        border-radius: 10px;
        font-weight: bold;
        margin-top: 10px;
      }

      .controls {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 10px;
      }

      button {
        padding: 12px 25px;
        font-size: 1.1rem;
        border: none;
        border-radius: 50px;
        background: linear-gradient(90deg, #2196f3, #21cbf3);
        color: white;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(33, 150, 243, 0.3);
        transition: all 0.3s ease;
      }

      button:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 12px rgba(33, 150, 243, 0.4);
      }

      button:active {
        transform: translateY(1px);
      }

      .success-message {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.95);
        padding: 30px 50px;
        border-radius: 20px;
        text-align: center;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        z-index: 100;
        display: none;
      }

      .success-message h2 {
        color: #4caf50;
        font-size: 2.5rem;
        margin-bottom: 20px;
      }

      .success-message p {
        font-size: 1.3rem;
        margin-bottom: 25px;
        line-height: 1.6;
      }

      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        z-index: 99;
      }

      @media (max-width: 768px) {
        .content {
          flex-direction: column;
        }

        .groups-container {
          flex-direction: column;
          align-items: center;
        }

        .group {
          width: 100%;
          max-width: 250px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>平均数：移多补少法</h1>
        <div class="subtitle">通过移动矿泉水瓶理解平均数的概念</div>
      </header>

      <div class="content">
        <div class="instructions">
          <h2>活动说明</h2>
          <ol>
            <li>四个小组收集了不同数量的矿泉水瓶</li>
            <li>通过拖拽瓶子，使每个小组的瓶子数量相等</li>
            <li>观察"移多补少"的过程</li>
            <li>理解平均数的意义：代表整体的平均水平</li>
            <li>成功条件：所有小组的瓶子数都等于平均数</li>
          </ol>

          <div class="formula-box">平均数 = 总瓶数 ÷ 小组数量</div>

          <p><strong>教学提示：</strong></p>
          <p>引导学生思考：为什么平均数可能不是整数？移动瓶子后总数改变了吗？平均数有什么实际意义？</p>
        </div>

        <div class="animation-area">
          <div class="groups-container" id="groupsContainer">
            <!-- 小组将由JS动态生成 -->
          </div>

          <div class="stats-container">
            <div class="stats-row">
              <span>总瓶数：</span>
              <span class="stats-value" id="totalBottles">24</span>
            </div>
            <div class="stats-row">
              <span>小组数量：</span>
              <span class="stats-value" id="groupCount">4</span>
            </div>
            <div class="average-display">平均数：<span id="averageValue">6</span></div>
          </div>

          <div class="controls">
            <button id="resetBtn">重置</button>
            <button id="checkBtn">检查结果</button>
          </div>
        </div>
      </div>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="success-message" id="successMessage">
      <h2>任务完成！</h2>
      <p>恭喜你通过"移多补少"的方法使所有小组的瓶子数量相等！</p>
      <p>你成功理解了平均数的概念：</p>
      <p>平均数 = 总瓶数 ÷ 小组数量 = <span id="finalAverage">6</span></p>
      <button id="closeSuccess">继续探索</button>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', () => {
        // 初始数据：小组名称和瓶子数量
        const groupsData = [
          { name: '第一组', bottles: 6 },
          { name: '第二组', bottles: 4 },
          { name: '第三组', bottles: 5 },
          { name: '第四组', bottles: 9 },
        ]

        const groupsContainer = document.getElementById('groupsContainer')
        const totalBottlesEl = document.getElementById('totalBottles')
        const averageValueEl = document.getElementById('averageValue')
        const resetBtn = document.getElementById('resetBtn')
        const checkBtn = document.getElementById('checkBtn')
        const successMessage = document.getElementById('successMessage')
        const overlay = document.getElementById('overlay')
        const closeSuccess = document.getElementById('closeSuccess')
        const finalAverageEl = document.getElementById('finalAverage')

        let bottles = []
        let draggingBottle = null
        let sourceGroup = null

        // 计算总瓶数和平均数
        function calculateStats() {
          const totalBottles = groupsData.reduce((sum, group) => sum + group.bottles, 0)
          const average = totalBottles / groupsData.length

          totalBottlesEl.textContent = totalBottles
          averageValueEl.textContent = average.toFixed(1)

          return { totalBottles, average }
        }

        // 渲染小组和瓶子
        function renderGroups() {
          groupsContainer.innerHTML = ''

          groupsData.forEach((group, groupIndex) => {
            const groupEl = document.createElement('div')
            groupEl.className = 'group'
            groupEl.dataset.index = groupIndex

            groupEl.innerHTML = `
                        <div class="group-title">${group.name}</div>
                        <div class="bottles-container" id="bottles-${groupIndex}">
                            <!-- 瓶子将由JS动态添加 -->
                        </div>
                        <div class="group-count">数量: <span>${group.bottles}</span></div>
                    `

            groupsContainer.appendChild(groupEl)

            const bottlesContainer = groupEl.querySelector('.bottles-container')

            // 创建瓶子元素
            for (let i = 0; i < group.bottles; i++) {
              const bottle = document.createElement('div')
              bottle.className = 'bottle'
              bottle.textContent = groupIndex + 1
              bottle.dataset.group = groupIndex
              bottle.draggable = true

              // 添加拖拽事件
              bottle.addEventListener('dragstart', handleDragStart)
              bottle.addEventListener('dragend', handleDragEnd)

              bottlesContainer.appendChild(bottle)
              bottles.push(bottle)
            }
          })

          // 添加放置区域的拖拽事件
          const bottleContainers = document.querySelectorAll('.bottles-container')
          bottleContainers.forEach((container) => {
            container.addEventListener('dragover', handleDragOver)
            container.addEventListener('dragenter', handleDragEnter)
            container.addEventListener('dragleave', handleDragLeave)
            container.addEventListener('drop', handleDrop)
          })
        }

        // 拖拽事件处理函数
        function handleDragStart(e) {
          draggingBottle = this
          sourceGroup = parseInt(this.dataset.group)

          setTimeout(() => {
            this.classList.add('dragging')
          }, 0)
        }

        function handleDragEnd() {
          this.classList.remove('dragging')
          draggingBottle = null
          sourceGroup = null
        }

        function handleDragOver(e) {
          e.preventDefault()
        }

        function handleDragEnter(e) {
          e.preventDefault()
          this.classList.add('drag-over')
        }

        function handleDragLeave() {
          this.classList.remove('drag-over')
        }

        function handleDrop(e) {
          e.preventDefault()
          this.classList.remove('drag-over')

          if (draggingBottle) {
            const targetGroup = parseInt(this.parentElement.dataset.index)

            // 如果拖拽到不同的组
            if (sourceGroup !== targetGroup) {
              // 更新数据
              groupsData[sourceGroup].bottles--
              groupsData[targetGroup].bottles++

              // 更新瓶子所属组
              draggingBottle.dataset.group = targetGroup

              // 重新渲染
              renderGroups()
              calculateStats()
            }
          }
        }

        // 检查结果
        function checkResult() {
          const { average } = calculateStats()
          const isSuccess = groupsData.every((group) => group.bottles === average)

          if (isSuccess) {
            finalAverageEl.textContent = average
            successMessage.style.display = 'block'
            overlay.style.display = 'block'
          } else {
            alert('还没有完成！继续尝试让每个小组的瓶子数量都等于平均数。')
          }
        }

        // 重置功能
        function resetGame() {
          groupsData[0].bottles = 6
          groupsData[1].bottles = 4
          groupsData[2].bottles = 5
          groupsData[3].bottles = 9

          renderGroups()
          calculateStats()
        }

        // 初始化
        renderGroups()
        calculateStats()

        // 事件监听
        resetBtn.addEventListener('click', resetGame)
        checkBtn.addEventListener('click', checkResult)
        closeSuccess.addEventListener('click', () => {
          successMessage.style.display = 'none'
          overlay.style.display = 'none'
        })
      })
    </script>
  </body>
</html>
